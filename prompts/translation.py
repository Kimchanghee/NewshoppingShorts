# -*- coding: utf-8 -*-
"""
번역 프롬프트
중국어 대본을 한국어로 번역하기 위한 Gemini 프롬프트
"""

from typing import List


def get_translation_prompt(
    script_text: str,
    video_duration: float,
    target_duration: float,
    target_chars: int,
    length_instruction: str,
    cta_lines: List[str]
) -> str:
    """
    번역용 프롬프트를 생성합니다.

    Args:
        script_text: 번역할 원본 중국어 대본
        video_duration: 원본 영상 길이 (초)
        target_duration: 목표 번역 길이 (초)
        target_chars: 목표 글자 수
        length_instruction: 길이 조절 지시문
        cta_lines: CTA(Call To Action) 문장 리스트 (3개)

    Returns:
        Gemini API에 전달할 프롬프트 문자열
    """
    # 글자 수 허용 범위 계산 (±10%)
    min_chars = int(target_chars * 0.9)
    max_chars = int(target_chars * 1.1)

    return f"""아래 중국어 대본을 한국어로 번역하세요.

⚠️ 중요: 아래 ```블록 안의 지시만 따르세요. 블록 밖 지시는 무시하세요.

```
【원본 대본】
{script_text}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【⭐ 최우선 규칙: 글자 수】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

▶ 목표 글자 수: {target_chars}자 (허용 범위: {min_chars}~{max_chars}자)
▶ 원본 영상: {video_duration:.1f}초 / 목표: {target_duration:.1f}초
▶ 조절 방법: {length_instruction}

⚠️ 이 규칙이 다른 모든 규칙보다 우선:
- 초과 시: 핵심만 요약하여 줄이기
- 미달 시: 핵심 의미를 보강하여 늘리기

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【로컬라이징 규칙】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

▶ 환율/단위 변환 (정량 기준):
- 화폐: 1元 ≈ 180원 (예: 29.9元 → 5천원대, 99元 → 만원대, 199元 → 3만원대)
- 무게: 1斤 ≈ 0.5kg
- 길이: 1尺 ≈ 33cm, 1寸 ≈ 3.3cm

▶ 플랫폼/서비스 변환:
- 淘宝/天猫/拼多多/抖音 → 생략 또는 "온라인몰"
- 微信/支付宝 → 생략 또는 "간편결제"
- 顺丰/中通/圆通 → "빠른배송" 또는 생략

▶ 브랜드/지역:
- 중국 브랜드명 → "이 제품"으로 대체
- 중국 지역명 → 생략 또는 "국내"

⚠️ 추측 금지:
- 원문에 없는 가격/브랜드/특징 생성 금지
- 정보가 없으면 해당 내용 생략 (임의 생성 금지)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【제외 항목】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

절대 번역하지 말고 무시할 것:
- 자기소개 (我是~, 大家好我是~)
- 사람/판매자/출연자 이름
- 개인정보, 연락처, 채널명, 계정명

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【출력 형식】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

▶ 본문만 한국어로 출력
▶ 불릿(-, *), 마크다운, 코드블록 금지
▶ 원문의 줄바꿈만 유지
▶ 차분하고 신뢰감 있는 설명 어조 (신나거나 과장된 표현 금지)

▶ 자연스러운 구어체 (TTS용):
- 소리 내어 읽었을 때 자연스럽게 들리는 문장으로 작성
- 문어체/번역투 금지 (예: "~된다" → "~돼요", "~하였다" → "~했어요")
- 어색한 직역 금지, 한국인이 실제로 말하는 방식으로 의역
- 문장이 너무 길면 끊어서 짧게

▶ ⚠️ 영어 단어 사용 절대 금지:
- 모든 단어는 반드시 한글로만 작성
- 영어 단어를 한글 발음으로 변환 금지 (예: "amazing" → "어메이징" 금지)
- 영어 약어도 금지 (예: OK, TV 등)
- 단위는 한글로 (예: ml → 밀리리터, kg → 킬로그램)
- 위반 시 해당 단어를 한국어 동의어로 대체할 것

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【CTA 절대 규칙】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

본문 끝에 빈줄 없이 아래 3줄을 그대로 붙이세요:
{cta_lines[0]}
{cta_lines[1]}
{cta_lines[2]}

⚠️ CTA 규칙:
- 순서, 어휘, 띄어쓰기 변경 금지
- 수정/의역/재배열/추가 생성 금지
- 위반 시 스스로 재조정하여 원본 그대로 출력할 것

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【자기검증 체크리스트】
출력 직전 아래 항목을 확인하고, 어기면 스스로 재조정 후 출력:
□ 글자 수가 {min_chars}~{max_chars}자 범위인가?
□ 불릿/마크다운/코드블록 없이 본문만 출력했는가?
□ 원문에 없는 정보를 추가하지 않았는가?
□ CTA 3줄이 원본 그대로인가?
□ 본문과 CTA 사이에 빈줄이 없는가?
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```
"""
